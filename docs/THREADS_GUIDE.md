# 多线程聊天功能使用指南

## 概述

IfAI Editor 现在支持多线程（多会话）聊天功能，让您可以：
- 同时进行多个独立的对话
- 每个对话完全隔离，互不干扰
- 让 Agent 任务在后台运行
- 搜索、标签管理、导出/导入对话

---

## 基础操作

### 创建新会话

1. 点击会话标签栏右侧的 **+ 新对话** 按钮
2. 或使用快捷键：**Ctrl+T** (Mac: **Cmd+T**)

### 切换会话

- 点击会话标签即可切换
- 快捷键：
  - **Ctrl+Tab** - 切换到下一个会话
  - **Ctrl+Shift+Tab** - 切换到上一个会话
  - **Ctrl+1~9** - 切换到第 1-9 个会话

### 关闭会话

- **右键点击** 会话标签关闭
- 或按住 **Ctrl** 点击会话标签
- 快捷键：**Ctrl+W** (关闭当前会话)

---

## 高级功能

### 固定重要会话

- **右键点击** 会话标签可固定/取消固定
- 固定的会话会显示书签图标 🖚
- 固定的会话始终排在前面，不会被自动归档

### 搜索会话

在搜索栏中输入关键词，实时搜索：
- 会话标题
- 会话描述
- 标签名称

### 标签过滤

1. 点击搜索栏右侧的标签按钮
2. 选择要过滤的标签
3. 点击"管理标签"可以：
   - 查看当前会话的所有标签
   - 创建新标签
   - 编辑/删除标签

**注意**：标签是会话隔离的，每个会话的标签独立管理。

### 自动归档

- 超过 30 天未活动的非固定会话会自动归档
- 归档的会话不会显示在会话列表中
- 可以通过设置重新激活归档的会话

---

## 后台任务

### 在后台运行 Agent

1. 在一个会话中启动 Agent 任务（如 `/explore`）
2. 立即创建新会话或切换到其他会话
3. Agent 会继续在原会话中运行

### 查看后台任务

- 右上角的浮动监控面板显示所有正在运行的 Agent
- 点击会话按钮可以快速切换到 Agent 所在的会话
- Agent 完成后会显示通知，点击"查看"可跳转

### 未读活动指示器

- 有后台活动的会话会显示蓝色圆点 📍
- 切换到该会话时，蓝色圆点会自动消失

---

## 数据管理

### 自动保存

- 所有对话会自动保存到浏览器存储
- 关闭应用后重新打开，对话会自动恢复
- 无需手动保存

### 导出对话

1. 打开设置 (**Ctrl+,** 或 **Cmd+,**)
2. 进入 **数据管理** 标签
3. 点击 **导出对话** 按钮
4. 选择保存位置，导出为 JSON 文件

### 导入对话

1. 打开设置 → 数据管理
2. 点击 **导入对话** 按钮
3. 选择之前导出的 JSON 文件
4. 导入后会自动刷新并加载所有对话

### 清除已删除对话

1. 打开设置 → 数据管理
2. 点击 **清除已删除对话**
3. 这将永久删除所有标记为"已删除"的会话

---

## 快捷键总览

| 快捷键 | 功能 |
|--------|------|
| **Ctrl+T** | 新建会话 |
| **Ctrl+W** | 关闭当前会话 |
| **Ctrl+Tab** | 切换到下一个会话 |
| **Ctrl+Shift+Tab** | 切换到上一个会话 |
| **Ctrl+1~9** | 切换到指定编号的会话 |
| **Ctrl+,** | 打开设置 |

---

## 常见问题

### Q: 创建新会话后为什么还显示之前的内容？

A: 这是一个已修复的 bug。如果您遇到此问题，请刷新页面或更新到最新版本。

### Q: 会话数量有限制吗？

A: 默认最多 20 个活跃会话。超过后，最旧的未固定会话会自动归档。

### Q: 标签是全局的吗？

A: 不，标签是会话隔离的。每个会话的标签完全独立，不会相互影响。

### Q: 如何恢复误删的会话？

A: 如果您已导出对话，可以通过导入功能恢复。否则，已删除的会话在清除前可以尝试从浏览器存储恢复。

### Q: 后台任务会影响性能吗？

A: Agent 任务在 Rust 后端运行，对前端性能影响很小。您可以放心在多个会话间切换。

---

## 技术细节

### 会话隔离

- 每个会话有独立的消息列表
- 切换会话时会自动保存和加载对应的消息
- Agent 任务与启动它的会话关联

### 持久化

- 使用 IndexedDB 存储会话数据
- 自动保存：每次有变化后 1 秒内保存
- 支持手动导出/导入 JSON 格式

### 性能优化

- React.memo 优化会话标签渲染
- useMemo 优化搜索和过滤
- 支持大量会话时仍保持流畅

---

## 反馈与建议

如果您在使用过程中遇到问题或有改进建议，欢迎：
- 提交 Issue: [GitHub Issues](https://github.com/your-repo/ifainew/issues)
- 加入讨论: [GitHub Discussions](https://github.com/your-repo/ifainew/discussions)

---

**版本**: 1.0.0
**更新日期**: 2024-12-26
