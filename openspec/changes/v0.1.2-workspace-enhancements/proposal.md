# v0.1.2 工作区增强功能提案

## Why（为什么）

当前版本（v0.1.0）的若爱编辑器已经实现了基础的代码编辑和 AI 辅助功能，但在多文件编辑和工作区管理方面仍存在以下痛点：

1. **单一视图限制**：用户无法同时查看和编辑多个文件，在需要对比代码、参考其他文件进行开发时效率低下
2. **单窗口限制**：在多显示器环境下，用户无法充分利用屏幕空间，限制了生产力
3. **固定快捷键**：快捷键无法自定义，不同用户习惯（如从 VS Code、IntelliJ 等其他编辑器迁移）的用户需要重新适应

这些限制使得若爱编辑器在专业开发场景下的竞争力不足。v0.1.2 版本将通过引入分屏编辑、多窗口支持和快捷键自定义功能来解决这些问题，显著提升用户体验。

## What Changes（改变什么）

### 核心功能

#### 1. 分屏编辑（Split Pane）
- **水平/垂直分屏**：支持将编辑器区域分割为多个窗格，可同时查看和编辑不同文件
- **灵活布局**：支持 1-4 个窗格的任意组合（如左右分屏、上下分屏、四象限等）
- **窗格管理**：
  - 拖拽文件到不同窗格
  - 调整窗格大小（拖动分割线）
  - 关闭/合并窗格
  - 窗格间跳转导航
- **同步滚动**：可选的窗格同步滚动功能（用于代码对比）

#### 2. 多窗口支持（Multi-Window）
- **独立窗口**：将编辑器拖出为独立窗口
- **多显示器支持**：在不同显示器上打开多个窗口
- **窗口状态管理**：
  - 记住窗口位置和大小
  - 保存/恢复窗口布局
  - 窗口间文件拖拽
- **主从窗口关系**：关闭主窗口时可选择保留或关闭所有子窗口

#### 3. 快捷键自定义（Keyboard Shortcuts Customization）
- **快捷键配置界面**：可视化的快捷键设置面板
- **预设方案**：
  - IfAI 默认方案
  - VS Code 兼容方案
  - IntelliJ IDEA 兼容方案
  - 自定义方案
- **快捷键功能**：
  - 搜索/过滤快捷键
  - 按类别浏览（编辑、导航、视图、调试等）
  - 检测快捷键冲突
  - 重置为默认值
- **导入/导出**：支持快捷键配置的导入和导出（JSON 格式）

### 技术实现要点

- **分屏实现**：基于 React 状态管理，使用 flexbox 布局，Monaco Editor 多实例管理
- **多窗口实现**：利用 Tauri 的多窗口 API，窗口间通过事件通信同步状态
- **快捷键系统**：构建可配置的快捷键注册表，支持动态绑定和解绑

## Impact（影响范围）

### 受影响的规格
- **editor** - 编辑器核心功能（新增分屏相关需求）
- **ui-layout** - UI 布局系统（新增规格，管理窗格和窗口布局）
- **keyboard-shortcuts** - 快捷键系统（新增规格，管理用户快捷键配置）

### 受影响的代码文件

**Frontend (React/TypeScript):**
- `src/components/Editor/MonacoEditor.tsx` - 支持多实例和窗格管理
- `src/components/Layout/` - 新增布局管理组件
  - `SplitPaneContainer.tsx` - 分屏容器组件
  - `PaneResizer.tsx` - 窗格大小调整组件
- `src/components/Settings/` - 设置界面扩展
  - `KeyboardShortcuts.tsx` - 快捷键配置面板
  - `LayoutSettings.tsx` - 布局设置面板
- `src/stores/` - 状态管理
  - `layout-store.ts` - 新增布局状态管理
  - `shortcuts-store.ts` - 新增快捷键状态管理
  - `editor-store.ts` - 修改，支持多编辑器实例
- `src/hooks/` - 自定义 Hooks
  - `useKeyboardShortcuts.ts` - 新增快捷键管理 Hook
  - `useWindowManager.ts` - 新增窗口管理 Hook
- `src/i18n/locales/` - 国际化
  - `en.json` - 英文文案（新增分屏、多窗口、快捷键相关）
  - `zh.json` - 中文文案（新增分屏、多窗口、快捷键相关）

**Backend (Rust/Tauri):**
- `src-tauri/src/lib.rs` - 新增多窗口相关命令
- `src-tauri/src/window.rs` - 新增窗口管理模块
- `src-tauri/src/config.rs` - 扩展配置管理（布局、快捷键）
- `src-tauri/tauri.conf.json` - 更新窗口配置

**配置和文档:**
- `README.md` - 更新功能列表
- `CHANGELOG.md` - 记录 v0.1.2 变更
- `docs/features/` - 新增功能文档
  - `split-pane.md` - 分屏使用指南
  - `multi-window.md` - 多窗口使用指南
  - `keyboard-shortcuts.md` - 快捷键自定义指南

### 依赖变更

**新增依赖:**
- `react-mosaic-component` (或类似库) - 高级窗格布局管理（可选，也可自实现）
- `mousetrap` (或 `hotkeys-js`) - 跨平台快捷键管理库

**Rust 依赖:**
- 无新增（使用 Tauri 2.0 已有的多窗口 API）

### 兼容性说明

- **向后兼容**：现有单窗口、单编辑器使用方式完全保留
- **配置迁移**：首次启动时自动生成默认布局和快捷键配置
- **数据持久化**：用户的布局和快捷键偏好保存在本地配置文件中

### 破坏性变更

- 无破坏性变更
- 所有新功能均为增量功能，不影响现有用户体验

## 用户价值

1. **提高生产力**：分屏和多窗口支持让用户能够更高效地处理多文件编辑任务
2. **降低学习曲线**：快捷键自定义让从其他编辑器迁移的用户能够保持原有习惯
3. **增强专业性**：这些功能是专业代码编辑器的标配，提升若爱编辑器的市场竞争力
4. **提升用户满意度**：满足高级用户对工作区管理的需求

## 风险和缓解

### 技术风险
1. **性能风险**：多编辑器实例可能增加内存占用
   - **缓解措施**：实现编辑器实例池，限制最大窗格数量（如 4 个）

2. **状态同步复杂性**：多窗口间的状态同步可能出现不一致
   - **缓解措施**：使用事件驱动架构，确保单一数据源（Single Source of Truth）

3. **快捷键冲突**：用户自定义快捷键可能与系统或浏览器快捷键冲突
   - **缓解措施**：实现冲突检测和警告机制

### 用户体验风险
1. **学习成本**：新功能可能让新用户感到复杂
   - **缓解措施**：提供引导教程，默认为简单模式

2. **UI 复杂度增加**：过多的窗格可能让界面混乱
   - **缓解措施**：提供清晰的视觉指示，限制窗格数量

## 成功指标

1. **功能完整性**：所有核心功能（分屏、多窗口、快捷键自定义）全部实现
2. **性能指标**：4 窗格分屏时内存占用 < 500MB，CPU 空闲时 < 5%
3. **用户反馈**：至少 80% 的测试用户对新功能表示满意
4. **Bug 率**：上线后 2 周内严重 Bug < 5 个

## 时间规划建议

- **总工作量估计**：3-4 周
- **里程碑**：
  - Week 1: 分屏编辑基础实现
  - Week 2: 多窗口支持和窗口管理
  - Week 3: 快捷键系统和配置界面
  - Week 4: 测试、文档和优化
