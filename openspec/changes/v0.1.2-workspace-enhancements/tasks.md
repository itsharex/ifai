# v0.1.2 工作区增强功能 - 实现任务清单

## 1. 前期准备和架构设计

- [x] 1.1 研究 Monaco Editor 多实例管理最佳实践
- [x] 1.2 调研 Tauri 2.0 多窗口 API 使用方法
- [x] 1.3 设计分屏布局数据结构（Layout State Schema）
- [x] 1.4 设计快捷键配置数据结构（Keybinding Schema）
- [x] 1.5 创建技术设计文档（design.md）
- [x] 1.6 评估并选择前端依赖库（react-mosaic vs 自实现）
- [x] 1.7 评估并选择快捷键库（mousetrap vs hotkeys-js）

## 2. 分屏编辑功能实现

### 2.1 布局状态管理
- [x] 2.1.1 创建 `layout-store.ts` Zustand store
- [x] 2.1.2 定义 Pane 数据模型（PaneModel interface）
- [x] 2.1.3 实现 Split 操作（水平/垂直分割）
- [x] 2.1.4 实现 Merge 操作（合并窗格）
- [x] 2.1.5 实现 Resize 操作（调整窗格大小）
- [x] 2.1.6 实现布局持久化（保存到本地配置）

### 2.2 UI 组件开发
- [x] 2.2.1 创建 `SplitPaneContainer.tsx` 主容器组件
- [x] 2.2.2 创建 `Pane.tsx` 单窗格组件（实际为 PaneView.tsx）
- [x] 2.2.3 创建 `PaneResizer.tsx` 分割线拖拽组件
- [x] 2.2.4 创建 `PaneHeader.tsx` 窗格头部（显示文件名、关闭按钮）
- [x] 2.2.5 实现窗格激活状态管理和视觉反馈
- [x] 2.2.6 实现拖拽文件到窗格功能
- [x] 2.2.7 添加窗格工具栏（分割、关闭等操作按钮）

### 2.3 编辑器集成
- [x] 2.3.1 修改 `MonacoEditor.tsx` 支持多实例
- [ ] 2.3.2 实现编辑器实例池管理
- [ ] 2.3.3 实现窗格间编辑器切换
- [ ] 2.3.4 实现同步滚动功能（可选）
- [ ] 2.3.5 优化编辑器实例的创建和销毁

### 2.4 快捷键和菜单
- [x] 2.4.1 添加分屏相关快捷键（Cmd+\、Cmd+K Cmd+\等）
- [x] 2.4.2 添加窗格导航快捷键（Cmd+1, Cmd+2等）
- [ ] 2.4.3 在菜单栏添加"查看">"编辑器布局"子菜单

## 3. 多窗口支持实现

### 3.1 Rust 后端窗口管理
- [ ] 3.1.1 创建 `window.rs` 模块
- [x] 3.1.2 实现 `create_editor_window` Tauri 命令 (已通过 `create_window` 实现)
- [ ] 3.1.3 实现 `close_window` Tauri 命令
- [x] 3.1.4 实现窗口位置和大小的保存/恢复 (已通过 tauri-plugin-window-state 实现)
- [ ] 3.1.5 实现窗口列表管理
- [ ] 3.1.6 更新 `tauri.conf.json` 多窗口配置

### 3.2 前端窗口管理
- [ ] 3.2.1 创建 `useWindowManager.ts` Hook
- [x] 3.2.2 实现窗口间事件通信（Tauri Events）
- [x] 3.2.3 实现窗口状态同步
- [ ] 3.2.4 实现文件在窗口间拖拽
- [x] 3.2.5 创建"新窗口打开"UI 入口
- [ ] 3.2.6 实现窗口关闭时的状态清理

### 3.3 主从窗口管理
- [ ] 3.3.1 区分主窗口和子窗口
- [x] 3.3.2 实现主窗口关闭时的子窗口处理逻辑 (主窗口关闭即退出应用)
- [x] 3.3.3 实现窗口间的文件打开状态共享

## 4. 快捷键自定义系统

### 4.1 快捷键核心系统
- [x] 4.1.1 创建 `shortcuts-store.ts` Zustand store
- [x] 4.1.2 定义快捷键数据模型（KeyBinding interface）
- [x] 4.1.3 创建 `useKeyboardShortcuts.ts` Hook（实际为 `useShortcuts.ts`）
- [x] 4.1.4 实现快捷键注册表（Keybinding Registry）
- [x] 4.1.5 实现快捷键动态绑定/解绑
- [x] 4.1.6 实现快捷键冲突检测
- [x] 4.1.7 实现快捷键持久化（保存到配置文件）

### 4.2 预设方案
- [x] 4.2.1 定义默认快捷键方案（IfAI Default）
- [x] 4.2.2 定义 VS Code 兼容方案
- [x] 4.2.3 定义 IntelliJ IDEA 兼容方案
- [x] 4.2.4 实现方案切换功能
- [x] 4.2.5 实现导入/导出功能（JSON 格式）

### 4.3 配置界面
- [x] 4.3.1 创建 `KeyboardShortcuts.tsx` 设置面板
- [x] 4.3.2 实现快捷键列表展示（按类别分组）
- [x] 4.3.3 实现快捷键搜索和过滤
- [x] 4.3.4 实现快捷键编辑（点击录入新快捷键）
- [x] 4.3.5 实现冲突提示 UI
- [x] 4.3.6 实现重置为默认值功能
- [x] 4.3.7 添加预设方案选择器
- [x] 4.3.8 添加导入/导出按钮

## 5. 状态管理和数据持久化

### 5.1 配置管理
- [ ] 5.1.1 扩展 Rust `config.rs` 模块
- [x] 5.1.2 添加布局配置读写（通过 Zustand persist 实现）
- [x] 5.1.3 添加快捷键配置读写（通过 Zustand persist 实现）
- [ ] 5.1.4 实现配置版本管理和迁移

### 5.2 编辑器状态同步
- [x] 5.2.1 修改 `editor-store.ts` 支持多实例（通过 layoutStore 实现）
- [x] 5.2.2 实现文件打开状态的窗格关联
- [ ] 5.2.3 实现窗格间的文件切换同步
- [ ] 5.2.4 实现编辑状态的持久化

## 6. 国际化

- [x] 6.1 添加分屏相关中文文案（`zh-CN.json`）
- [x] 6.2 添加分屏相关英文文案（`en-US.json`）
- [x] 6.3 添加多窗口相关中文文案（`zh-CN.json`）
- [x] 6.4 添加多窗口相关英文文案（`en-US.json`）
- [x] 6.5 添加快捷键相关中文文案（`zh-CN.json`）
- [x] 6.6 添加快捷键相关英文文案（`en-US.json`）

## 7. 用户体验优化

- [ ] 7.1 添加分屏引导教程（首次使用提示）
- [ ] 7.2 添加快捷键配置引导
- [x] 7.3 实现窗格拖拽时的视觉反馈（通过 PaneResizer 实现）
- [ ] 7.4 实现窗格大小调整时的平滑动画
- [x] 7.5 添加键盘导航支持（通过快捷键 Mod+1/2/3/4 实现）
- [ ] 7.6 优化触摸屏支持（如果适用）

## 8. 性能优化

- [ ] 8.1 实现编辑器实例的懒加载
- [ ] 8.2 优化多窗格时的重绘性能
- [x] 8.3 限制最大窗格数量（避免性能问题）（在 layoutStore 中设置 MAX_PANES = 4）
- [ ] 8.4 实现编辑器实例的内存回收
- [ ] 8.5 优化窗口间通信的性能
- [ ] 8.6 进行性能测试和基准测试

## 9. 测试

### 9.1 单元测试
- [ ] 9.1.1 测试布局 Store（layout-store.test.ts）
- [ ] 9.1.2 测试快捷键 Store（shortcuts-store.test.ts）
- [ ] 9.1.3 测试窗口管理 Hook（useWindowManager.test.ts）
- [ ] 9.1.4 测试快捷键管理 Hook（useKeyboardShortcuts.test.ts）

### 9.2 集成测试
- [ ] 9.2.1 测试分屏创建和销毁流程
- [ ] 9.2.2 测试多窗口打开和关闭流程
- [ ] 9.2.3 测试快捷键绑定和冲突检测
- [ ] 9.2.4 测试配置的保存和恢复

### 9.3 UI 测试
- [ ] 9.3.1 测试窗格拖拽和调整大小
- [ ] 9.3.2 测试快捷键配置界面交互
- [ ] 9.3.3 测试多窗口下的文件拖拽

### 9.4 跨平台测试
- [ ] 9.4.1 在 macOS 上测试所有功能
- [ ] 9.4.2 在 Windows 上测试所有功能
- [ ] 9.4.3 在 Linux 上测试所有功能

## 10. 文档

- [ ] 10.1 编写分屏使用指南（`docs/features/split-pane.md`）
- [ ] 10.2 编写多窗口使用指南（`docs/features/multi-window.md`）
- [ ] 10.3 编写快捷键自定义指南（`docs/features/keyboard-shortcuts.md`）
- [ ] 10.4 更新 README.md 功能列表
- [ ] 10.5 编写 CHANGELOG.md（v0.1.2 部分）
- [ ] 10.6 更新在线帮助文档（如果有）

## 11. 发布准备

- [ ] 11.1 代码审查（Code Review）
- [ ] 11.2 性能基准测试
- [ ] 11.3 修复所有已知 Bug
- [ ] 11.4 更新版本号到 v0.1.2（package.json、Cargo.toml）
- [ ] 11.5 生成发布构建（macOS、Windows、Linux）
- [ ] 11.6 编写发布说明（Release Notes）
- [ ] 11.7 创建 Git 标签（v0.1.2）
- [ ] 11.8 发布到 GitHub Releases

## 验收标准

每个功能都必须满足以下标准才能标记为完成：
- ✅ 功能完整实现，符合规格要求
- ✅ 代码通过 TypeScript/Rust 编译检查
- ✅ 单元测试覆盖率 > 80%（如适用）
- ✅ 在所有支持平台上测试通过
- ✅ UI/UX 符合设计规范
- ✅ 国际化文案完整（中英文）
- ✅ 性能达标（内存、CPU 使用）
- ✅ 文档完整且准确
